{
	"name": "serverlesssqlcodes",
	"properties": {
		"content": {
			"query": "-- master key creation for external table\nCREATE MASTER KEY ENCRYPTION by PASSWORD='organ02@2025'\n\n-- cretae credential\nCREATE DATABASE SCOPED CREDENTIAL azurefileproxy\nWITH\nIDENTITY = 'Managed Identity'\n\n-- creat external data source\n-- add the linked services to connec to to the azure\nCREATE EXTERNAL DATA SOURCE ds_sargsynapse \nWITH\n(\n    LOCATION= 'https://sargsynapse.dfs.core.windows.net/raw',\n    CREDENTIAL= azurefileproxy\n\n)\n\n\n-- This is auto-generated code\nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK '/survey/annual-enterprise-survey-2023-financial-year-provisional-size-bands (1).csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION = '2.0'\n    ) AS [result]\n\n\n-- create file format\nCREATE EXTERNAL FILE FORMAT ext_csv\nWITH (\n    FORMAT_TYPE= DELIMITEDTEXT, \n    FORMAT_OPTIONS(\n        FIELD_TERMINATOR=''\n    )\n)\n\n\n--create external table \nCREATE EXTERNAL TABLE survey_ext_table\n(   \n    year int,\n    industry_code_ANZSIC varchar(200),\n    industry_name_ANZSIC varchar(200),\n    rme_size_grp varchar(200),\n    variable varchar(200),\n    value INT,\n    unit varchar(200)\n)\nwith\n(  \n    LOCATION='survey',\n    DATA_SOURCE=ds_sargsynapse,\n    FILE_FORMAT=ext_csv\n)\n\nselect * from survey_ext_table\n\n\n\n\n--  CETAS--- create external table from a query\nCREATE EXTERNAL TABLE survey_ext_table\n(   \n    year int,\n    industry_code_ANZSIC varchar(200),\n    industry_name_ANZSIC varchar(200),\n    rme_size_grp varchar(200),\n    variable varchar(200),\n    value INT,\n    unit varchar(200)\n)\nwith\n(  \n    LOCATION='survey',\n    DATA_SOURCE=ds_sargsynapse,\n    FILE_FORMAT=ext_csv\n)\nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK 'https://sargsynapse.dfs.core.windows.net/raw/survey/annual-enterprise-survey-2023-financial-year-provisional-size-bands (1).csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION = '2.0'\n    ) AS [result]\n\n\n\n\n-- create a new view\nCREATE VIEW view_survey_ext_table\nAS\nSELECT\n    TOP 100 *\nFROM\n    OPENROWSET(\n        BULK 'https://sargsynapse.dfs.core.windows.net/raw/survey/annual-enterprise-survey-2023-financial-year-provisional-size-bands (1).csv',\n        FORMAT = 'CSV',\n        PARSER_VERSION = '2.0'\n    ) AS [result]\n\n\n------ copy into\n-- copy file from external to dedicated sql pool\nCREATE TABLE survey_dedicated_table\n(   \n    year int,\n    industry_code_ANZSIC varchar(200),\n    industry_name_ANZSIC varchar(200),\n    rme_size_grp varchar(200),\n    variable varchar(200),\n    value INT,\n    unit varchar(200)\n)\nwith\n(  \n    DISTRIBUTION= ROUND_ROBIN\n)\n\nselect * from survey_dedicated_table;\n\ncopy into survey_dedicated_table\n(year 1,\n    industry_code_ANZSIC 2,\n    industry_name_ANZSIC 3,\n    rme_size_grp 4,\n    variable 5,\n    value 6,\n    unit 7\n)\nfrom 'https://sargsynapse.dfs.core.windows.net/raw/survey/annual-enterprise-survey-2023-financial-year-provisional-size-bands (1).csv'\nWITH(\n    FILE_Type= 'Parquet',\n    CREDENTIAL= azurefileproxy\n)",
			"metadata": {
				"language": "sql"
			},
			"currentConnection": {
				"databaseName": "azure_external",
				"poolName": "Built-in"
			},
			"resultLimit": 5000
		},
		"type": "SqlQuery"
	}
}